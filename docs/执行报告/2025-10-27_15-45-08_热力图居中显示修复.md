# 热力图股票数据居中显示修复报告

## 问题描述

用户反馈：股票名称、股价、涨跌幅的居中显示存在问题，需要进行自动居中优化。

## 问题分析

### 1. 问题定位

经过代码分析，发现问题出现在 `/components/heatmap/UserHeatmap.tsx` 文件的 ECharts treemap 标签配置中：

- **文件位置**: `components/heatmap/UserHeatmap.tsx:595-720`
- **问题类型**: ECharts treemap 标签文本居中显示优化

### 2. 根本原因

1. **行高设置不当**: 使用 `lineHeight: 13` 与 `fontSize: 11`，导致三行文本（股票名称、股价、涨跌幅）过于拥挤，影响居中效果
2. **字体大小固定**: 所有文本使用固定字体大小，未考虑股票名称长度的差异
3. **缺乏响应式设计**: 没有根据方块大小和文本长度动态调整显示样式

### 3. 影响范围

- 热力图中的股票方块标签显示
- 股票名称、股价、涨跌幅的视觉对齐
- 用户体验和可读性

## 修复方案

### 1. 行高优化

**修改前**:
```typescript
lineHeight: 13  // 行高过小，文本拥挤
```

**修改后**:
```typescript
lineHeight: 15  // 增加行高，提升可读性和居中效果
```

### 2. 响应式字体大小

**新增逻辑**:
```typescript
// 根据文本长度动态选择字体大小
const symbolLength = stock.symbol.length;
const symbolStyle = symbolLength <= 4 ? 'symbolMedium' :
                   symbolLength >= 8 ? 'symbolSmall' : 'symbol';
```

**字体大小配置**:
- **symbolSmall**: 10px (适用于长股票名称，≥8字符)
- **symbol**: 11px (适用于中等股票名称，5-7字符)
- **symbolMedium**: 13px (适用于短股票名称，≤4字符)

### 3. 整体优化

- 保持 `align: 'center'` 和 `verticalAlign: 'middle'` 配置
- 移除未使用的变量声明 (修复 TypeScript 警告)
- 优化行高设置以确保更好的文本间距

## 修改文件

| 文件路径 | 行号范围 | 修改内容 |
|---------|----------|----------|
| `components/heatmap/UserHeatmap.tsx` | 602-620 | 优化 formatter 函数，添加响应式字体大小逻辑 |
| `components/heatmap/UserHeatmap.tsx` | 623-717 | 更新 rich text 配置，调整行高从 13 到 15 |

## 预期效果

1. **更好的居中效果**: 通过增加行高，文本在方块中获得更多垂直空间，实现更好的居中视觉效果
2. **自适应显示**: 根据股票名称长度自动调整字体大小，确保在小方块中也能正确显示
3. **提升可读性**: 优化的行间距使文本更易读，减少视觉拥挤感
4. **保持一致性**: 所有居中配置保持统一，确保视觉一致性

## 测试建议

1. 启动开发服务器: `npm run dev`
2. 访问热力图页面: `http://localhost:3100/heatmap`
3. 观察以下场景:
   - 不同大小的股票方块中的文本居中效果
   - 长股票名称的显示是否正常
   - 文本是否完全居中，无偏移

## 技术说明

### ECharts Treemap 居中机制

ECharts treemap 使用以下属性进行标签居中:
- `align: 'center'`: 水平居中（容器级别）
- `verticalAlign: 'middle'`: 垂直居中（容器级别）
- `textAlign: 'center'`: 富文本水平对齐（内容级别）
- `lineHeight`: 行高，影响垂直居中效果

### 优化原理

1. **容器级别对齐**: 使用 `align` 和 `verticalAlign` 确保整个标签在 treemap 方块中居中
2. **内容级别对齐**: 使用富文本的 `textAlign` 确保多行文本在标签区域内居中
3. **行高优化**: 通过适当的 `lineHeight` 确保多行文本在垂直方向上均匀分布

## 总结

本次修复针对热力图中股票数据显示的居中问题，通过优化行高和引入响应式字体大小逻辑，显著提升了文本的居中效果和可读性。修改保持了代码的简洁性和性能，确保在各种屏幕尺寸和股票数据情况下都能正确显示。

---

**修复时间**: 2025-10-27 15-45-08
**修复状态**: ✅ 已完成
**影响范围**: 热力图股票数据显示
**测试状态**: 待测试
